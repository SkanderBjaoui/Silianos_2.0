<div class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <app-navbar></app-navbar>

  <div class="pt-20 flex">
    <!-- Sidebar Navigation -->
    <aside class="w-64 min-h-[calc(100vh-5rem)] bg-slate-900/50 border-r border-slate-800 sticky top-20">
      <div class="p-6">
        <!-- User Profile Summary -->
        <div class="mb-6 pb-6 border-b border-slate-800">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-cyan-500 to-emerald-500 flex items-center justify-center text-white text-lg font-bold">
              {{ user?.name?.charAt(0)?.toUpperCase() || 'U' }}
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="text-sm font-semibold text-white truncate">{{ user?.name }}</h3>
              <p class="text-xs text-slate-400 truncate">{{ user?.email }}</p>
            </div>
          </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="space-y-2">
          <button
            (click)="activeSection = 'overview'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'overview' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="layoutIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Vue d'ensemble</span>
          </button>

          <button
            (click)="activeSection = 'reservations'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'reservations' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="calendarIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Mes Réservations</span>
            @if (bookings.length > 0) {
              <span class="ml-auto px-2 py-0.5 bg-cyan-500/20 text-cyan-400 rounded-full text-xs font-semibold">
                {{ bookings.length }}
              </span>
            }
          </button>

          <button
            (click)="activeSection = 'payments'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'payments' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="creditCardIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Paiements</span>
          </button>

          <button
            (click)="activeSection = 'profile'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'profile' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="userIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Mon Profil</span>
          </button>

          <button
            (click)="activeSection = 'favorites'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'favorites' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="heartIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Favoris</span>
          </button>

          <button
            (click)="activeSection = 'notifications'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'notifications' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="bellIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Notifications</span>
          </button>

          <button
            (click)="activeSection = 'support'"
            [class]="'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ' + (activeSection === 'support' ? 'bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 text-cyan-400 border border-cyan-500/30' : 'text-slate-300 hover:bg-slate-800 hover:text-white')"
          >
            <lucide-icon [name]="helpCircleIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Support</span>
          </button>
        </nav>

        <!-- Logout Button -->
        <div class="mt-8 pt-6 border-t border-slate-800">
          <button
            (click)="logout()"
            class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-red-500/20 hover:text-red-400 hover:border-red-500/30 border border-transparent transition-all"
          >
            <lucide-icon [name]="logoutIcon" class="w-5 h-5"></lucide-icon>
            <span class="font-medium">Déconnexion</span>
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Overview Section -->
      @if (activeSection === 'overview') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Bienvenue, {{ user?.name }}</h1>
            <p class="text-slate-400">Voici un aperçu de votre compte</p>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-slate-400 text-sm font-medium">Réservations</h3>
                <lucide-icon [name]="calendarIcon" class="w-5 h-5 text-cyan-400"></lucide-icon>
              </div>
              <p class="text-3xl font-bold text-white">{{ bookings.length }}</p>
              <p class="text-slate-400 text-sm mt-2">Total des réservations</p>
            </div>

            <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-slate-400 text-sm font-medium">Moyens de paiement</h3>
                <lucide-icon [name]="creditCardIcon" class="w-5 h-5 text-emerald-400"></lucide-icon>
              </div>
              <p class="text-3xl font-bold text-white">{{ paymentMethods.length }}</p>
              <p class="text-slate-400 text-sm mt-2">Enregistrés</p>
            </div>

            <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-slate-400 text-sm font-medium">Favoris</h3>
                <lucide-icon [name]="heartIcon" class="w-5 h-5 text-rose-400"></lucide-icon>
              </div>
              <p class="text-3xl font-bold text-white">{{ favorites.length }}</p>
              <p class="text-slate-400 text-sm mt-2">Destinations sauvegardées</p>
            </div>
          </div>

          <!-- Recent Reservations -->
          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            <h2 class="text-xl font-bold text-white mb-4">Réservations récentes</h2>
            @if (bookings.length === 0) {
              <div class="text-center py-8 text-slate-400">
                <p>Aucune réservation pour le moment</p>
                <a routerLink="/booking" class="text-cyan-400 hover:text-cyan-300 mt-4 inline-block">
                  Faire une réservation
                </a>
              </div>
            } @else {
              <div class="space-y-3">
                @for (booking of bookings.slice(0, 3); track booking.id) {
                  <div class="flex items-center justify-between p-4 rounded-xl border border-slate-700 hover:border-slate-600 transition-colors">
                    <div>
                      <h3 class="text-white font-semibold">{{ booking.serviceType }}</h3>
                      <p class="text-slate-400 text-sm">{{ formatDate(booking.departureDate) }}</p>
                    </div>
                    <span [class]="'px-3 py-1 rounded-lg text-xs font-semibold border ' + getStatusColor(booking.status)">
                      {{ getStatusLabel(booking.status) }}
                    </span>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Reservations Section -->
      @if (activeSection === 'reservations') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Mes Réservations</h1>
            <p class="text-slate-400">Gérez toutes vos réservations</p>
          </div>

          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            @if (bookings.length === 0) {
              <div class="text-center py-12 text-slate-400">
                <lucide-icon [name]="calendarIcon" class="w-16 h-16 mx-auto mb-4 text-slate-600"></lucide-icon>
                <p class="text-lg mb-2">Aucune réservation pour le moment</p>
                <a routerLink="/booking" class="text-cyan-400 hover:text-cyan-300 mt-4 inline-block font-semibold">
                  Faire une réservation
                </a>
              </div>
            } @else {
              <div class="space-y-4">
                @for (booking of bookings; track booking.id) {
                  <div class="rounded-xl p-5 border border-slate-700 hover:border-slate-600 transition-colors bg-slate-800/30">
                    <div class="flex items-start justify-between mb-4">
                      <div>
                        <h3 class="text-lg font-semibold text-white mb-1">{{ booking.serviceType }}</h3>
                        @if (booking.destination) {
                          <p class="text-slate-400 text-sm">{{ booking.destination }}</p>
                        }
                      </div>
                      <span [class]="'px-3 py-1 rounded-lg text-xs font-semibold border ' + getStatusColor(booking.status)">
                        {{ getStatusLabel(booking.status) }}
                      </span>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4 mb-4 text-sm">
                      <div>
                        <p class="text-slate-400">Date de départ</p>
                        <p class="text-white">{{ formatDate(booking.departureDate) }}</p>
                      </div>
                      @if (booking.returnDate) {
                        <div>
                          <p class="text-slate-400">Date de retour</p>
                          <p class="text-white">{{ formatDate(booking.returnDate) }}</p>
                        </div>
                      }
                      <div>
                        <p class="text-slate-400">Nombre de voyageurs</p>
                        <p class="text-white">{{ booking.numberOfTravelers }}</p>
                      </div>
                      @if (booking.totalAmount) {
                        <div>
                          <p class="text-slate-400">Montant total</p>
                          <p class="text-white font-semibold">{{ booking.totalAmount }}€</p>
                        </div>
                      }
                    </div>

                    @if (booking.paymentStatus) {
                      <div class="mb-4">
                        <span [class]="'px-3 py-1 rounded-lg text-xs font-semibold border ' + getPaymentStatusColor(booking.paymentStatus)">
                          {{ getPaymentStatusLabel(booking.paymentStatus) }}
                        </span>
                      </div>
                    }

                    @if (canPay(booking)) {
                      <button
                        (click)="openPaymentModal(booking)"
                        class="w-full md:w-auto px-4 py-2 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2"
                      >
                        <lucide-icon [name]="dollarIcon" class="w-4 h-4"></lucide-icon>
                        Finaliser le paiement
                      </button>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Payments Section -->
      @if (activeSection === 'payments') {
        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-3xl font-bold text-white mb-2">Moyens de Paiement</h1>
              <p class="text-slate-400">Gérez vos méthodes de paiement</p>
            </div>
            <button
              (click)="openAddPaymentModal()"
              class="px-4 py-2 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2"
            >
              <lucide-icon [name]="plusIcon" class="w-5 h-5"></lucide-icon>
              Ajouter
            </button>
          </div>

          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            @if (paymentMethods.length === 0) {
              <div class="text-center py-12 text-slate-400">
                <lucide-icon [name]="creditCardIcon" class="w-16 h-16 mx-auto mb-4 text-slate-600"></lucide-icon>
                <p class="text-lg mb-4">Aucun moyen de paiement</p>
                <button
                  (click)="openAddPaymentModal()"
                  class="px-4 py-2 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all"
                >
                  Ajouter un moyen de paiement
                </button>
              </div>
            } @else {
              <div class="space-y-3">
                @for (method of paymentMethods; track method.id) {
                  <div class="rounded-xl p-4 border border-slate-700 bg-slate-800/30">
                    <div class="flex items-start justify-between mb-2">
                      <div class="flex-1">
                        @if (method.type === 'card') {
                          <p class="text-white font-semibold">{{ maskCardNumber(method.cardNumber) }}</p>
                          <p class="text-slate-400 text-sm">{{ method.cardHolder }}</p>
                          <p class="text-slate-400 text-xs">{{ method.expiryDate }}</p>
                        } @else {
                          <p class="text-white font-semibold">{{ method.bankName }}</p>
                          <p class="text-slate-400 text-sm">{{ method.accountNumber }}</p>
                        }
                      </div>
                      @if (method.isDefault) {
                        <span class="px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded-lg text-xs font-semibold border border-emerald-500/30">
                          Par défaut
                        </span>
                      }
                    </div>
                    <div class="flex gap-2 mt-3">
                      @if (!method.isDefault) {
                        <button
                          (click)="setDefaultPaymentMethod(method.id)"
                          class="flex-1 px-3 py-1.5 text-xs rounded-lg border border-slate-600 text-slate-300 hover:border-cyan-400 hover:text-cyan-400 transition-colors"
                        >
                          Définir par défaut
                        </button>
                      }
                      <button
                        (click)="removePaymentMethod(method.id)"
                        class="px-3 py-1.5 text-xs rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/20 transition-colors"
                      >
                        Supprimer
                      </button>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Profile Section -->
      @if (activeSection === 'profile') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Mon Profil</h1>
            <p class="text-slate-400">Gérez vos informations personnelles</p>
          </div>

          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            <div class="flex items-center gap-6 mb-8 pb-8 border-b border-slate-800">
              <div class="w-20 h-20 rounded-full bg-gradient-to-r from-cyan-500 to-emerald-500 flex items-center justify-center text-white text-3xl font-bold">
                {{ user?.name?.charAt(0)?.toUpperCase() || 'U' }}
              </div>
              <div>
                <h3 class="text-2xl font-semibold text-white mb-1">{{ user?.name }}</h3>
                <p class="text-slate-400">{{ user?.email }}</p>
                @if (user?.phone) {
                  <p class="text-slate-400 text-sm mt-1">{{ user?.phone }}</p>
                }
              </div>
            </div>

            <form (ngSubmit)="updateProfile()" class="space-y-6">
              <div>
                <label class="block text-sm font-semibold text-slate-300 mb-2">Nom complet</label>
                <input
                  type="text"
                  [(ngModel)]="editProfile.name"
                  name="name"
                  class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-3 focus:border-cyan-400 focus:outline-none"
                />
              </div>

              <div>
                <label class="block text-sm font-semibold text-slate-300 mb-2">Email</label>
                <input
                  type="email"
                  [(ngModel)]="editProfile.email"
                  name="email"
                  class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-3 focus:border-cyan-400 focus:outline-none"
                />
              </div>

              <div>
                <label class="block text-sm font-semibold text-slate-300 mb-2">Téléphone</label>
                <input
                  type="tel"
                  [(ngModel)]="editProfile.phone"
                  name="phone"
                  class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-3 focus:border-cyan-400 focus:outline-none"
                  placeholder="+216 XX XXX XXX"
                />
              </div>

              <div class="flex gap-3 pt-4">
                <button
                  type="button"
                  (click)="cancelEdit()"
                  class="flex-1 px-4 py-3 rounded-xl border border-slate-600 text-slate-300 hover:border-slate-500 transition-colors"
                >
                  Annuler
                </button>
                <button
                  type="submit"
                  class="flex-1 px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-semibold hover:shadow-lg transition-all"
                >
                  Enregistrer les modifications
                </button>
              </div>
            </form>
          </div>
        </div>
      }

      <!-- Favorites Section -->
      @if (activeSection === 'favorites') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Mes Favoris</h1>
            <p class="text-slate-400">Vos destinations et services sauvegardés</p>
          </div>

          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            @if (favorites.length === 0) {
              <div class="text-center py-12 text-slate-400">
                <lucide-icon [name]="heartIcon" class="w-16 h-16 mx-auto mb-4 text-slate-600"></lucide-icon>
                <p class="text-lg mb-2">Aucun favori pour le moment</p>
                <p class="text-sm">Explorez nos services et ajoutez vos favoris</p>
              </div>
            } @else {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for (favorite of favorites; track favorite.id) {
                  <div class="rounded-xl p-4 border border-slate-700 bg-slate-800/30 hover:border-slate-600 transition-colors">
                    <h3 class="text-white font-semibold mb-2">{{ favorite.title }}</h3>
                    <p class="text-slate-400 text-sm mb-4">{{ favorite.description }}</p>
                    <button
                      (click)="removeFavorite(favorite.id)"
                      class="text-red-400 hover:text-red-300 text-sm flex items-center gap-1"
                    >
                      <lucide-icon [name]="xIcon" class="w-4 h-4"></lucide-icon>
                      Retirer des favoris
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Notifications Section -->
      @if (activeSection === 'notifications') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Notifications</h1>
            <p class="text-slate-400">Gérez vos préférences de notification</p>
          </div>

          <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
            @if (notifications.length === 0) {
              <div class="text-center py-12 text-slate-400">
                <lucide-icon [name]="bellIcon" class="w-16 h-16 mx-auto mb-4 text-slate-600"></lucide-icon>
                <p class="text-lg">Aucune notification</p>
              </div>
            } @else {
              <div class="space-y-3">
                @for (notification of notifications; track notification.id) {
                  <div class="rounded-xl p-4 border border-slate-700 bg-slate-800/30 flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center flex-shrink-0">
                      <lucide-icon [name]="bellIcon" class="w-5 h-5 text-cyan-400"></lucide-icon>
                    </div>
                    <div class="flex-1">
                      <h3 class="text-white font-semibold mb-1">{{ notification.title }}</h3>
                      <p class="text-slate-400 text-sm">{{ notification.message }}</p>
                      <p class="text-slate-500 text-xs mt-2">{{ formatDate(notification.date) }}</p>
                    </div>
                    @if (!notification.read) {
                      <span class="w-2 h-2 rounded-full bg-cyan-400 flex-shrink-0 mt-2"></span>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Support Section -->
      @if (activeSection === 'support') {
        <div class="space-y-6">
          <div>
            <h1 class="text-3xl font-bold text-white mb-2">Support</h1>
            <p class="text-slate-400">Besoin d'aide? Contactez-nous</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
              <h3 class="text-xl font-bold text-white mb-4">Contactez-nous</h3>
              <div class="space-y-4">
                <div>
                  <p class="text-slate-400 text-sm mb-1">Email</p>
                  <p class="text-white">support&#64;silianos-voyage.com</p>
                </div>
                <div>
                  <p class="text-slate-400 text-sm mb-1">Téléphone</p>
                  <p class="text-white">+216 98 147 666</p>
                  <p class="text-white">+216 98 140 565</p>
                </div>
                <div>
                  <p class="text-slate-400 text-sm mb-1">Horaires</p>
                  <p class="text-white">Lun - Ven: 9h - 18h</p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-800 p-6 bg-slate-900/50">
              <h3 class="text-xl font-bold text-white mb-4">FAQ</h3>
              <div class="space-y-3">
                <div class="p-3 rounded-xl border border-slate-700 bg-slate-800/30">
                  <h4 class="text-white font-semibold text-sm mb-1">Comment modifier ma réservation?</h4>
                  <p class="text-slate-400 text-xs">Contactez-nous par email ou téléphone pour modifier votre réservation.</p>
                </div>
                <div class="p-3 rounded-xl border border-slate-700 bg-slate-800/30">
                  <h4 class="text-white font-semibold text-sm mb-1">Quels sont les moyens de paiement acceptés?</h4>
                  <p class="text-slate-400 text-xs">Nous acceptons les cartes bancaires et les virements bancaires.</p>
                </div>
                <div class="p-3 rounded-xl border border-slate-700 bg-slate-800/30">
                  <h4 class="text-white font-semibold text-sm mb-1">Puis-je annuler ma réservation?</h4>
                  <p class="text-slate-400 text-xs">Oui, vous pouvez annuler selon nos conditions d'annulation.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </main>
  </div>
</div>

<!-- Payment Modal -->
@if (showPaymentModal && selectedBooking) {
  <div
    class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    (click)="closePaymentModal()"
  >
    <div
      class="rounded-2xl border border-slate-800 max-w-md w-full p-6 bg-slate-900"
      (click)="$event.stopPropagation()"
    >
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-white">Finaliser le Paiement</h2>
        <button
          (click)="closePaymentModal()"
          class="p-2 rounded-lg hover:bg-slate-700 text-slate-400 hover:text-white"
        >
          <lucide-icon [name]="xIcon" class="w-5 h-5"></lucide-icon>
        </button>
      </div>

      <div class="space-y-4 mb-6">
        <div>
          <p class="text-slate-400 text-sm">Réservation</p>
          <p class="text-white font-semibold">{{ selectedBooking.serviceType }}</p>
        </div>
        <div>
          <p class="text-slate-400 text-sm">Montant total</p>
          <p class="text-2xl font-bold text-white">{{ selectedBooking.totalAmount }}€</p>
        </div>
        <div>
          <p class="text-slate-400 text-sm mb-2">Moyen de paiement</p>
          @if (paymentMethods.length > 0) {
            @for (method of paymentMethods; track method.id) {
              @if (method.isDefault) {
                <div class="rounded-xl p-3 border border-slate-700 bg-slate-800/50">
                  @if (method.type === 'card') {
                    <p class="text-white font-semibold">{{ maskCardNumber(method.cardNumber) }}</p>
                    <p class="text-slate-400 text-sm">{{ method.cardHolder }}</p>
                  } @else {
                    <p class="text-white font-semibold">{{ method.bankName }}</p>
                    <p class="text-slate-400 text-sm">{{ method.accountNumber }}</p>
                  }
                </div>
              }
            }
          } @else {
            <p class="text-slate-400 text-sm">Aucun moyen de paiement</p>
            <button
              (click)="showPaymentModal = false; openAddPaymentModal()"
              class="mt-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all"
            >
              Ajouter un moyen de paiement
            </button>
          }
        </div>
      </div>

      <div class="flex gap-3">
        <button
          (click)="closePaymentModal()"
          class="flex-1 px-4 py-2 rounded-xl border border-slate-600 text-slate-300 hover:border-slate-500 transition-colors"
        >
          Annuler
        </button>
        <button
          (click)="processPayment()"
          [disabled]="paymentMethods.length === 0"
          class="flex-1 px-4 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Payer
        </button>
      </div>
    </div>
  </div>
}

<!-- Add Payment Method Modal -->
@if (showAddPaymentModal) {
  <div
    class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    (click)="closeAddPaymentModal()"
  >
    <div
      class="rounded-2xl border border-slate-800 max-w-md w-full p-6 bg-slate-900"
      (click)="$event.stopPropagation()"
    >
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-white">Ajouter un Moyen de Paiement</h2>
        <button
          (click)="closeAddPaymentModal()"
          class="p-2 rounded-lg hover:bg-slate-700 text-slate-400 hover:text-white"
        >
          <lucide-icon [name]="xIcon" class="w-5 h-5"></lucide-icon>
        </button>
      </div>

      <form (ngSubmit)="addPaymentMethod()" class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-slate-300 mb-2">Type</label>
          <select
            [(ngModel)]="newPaymentMethod.type"
            name="type"
            class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
          >
            <option value="card">Carte bancaire</option>
            <option value="bank">Compte bancaire</option>
          </select>
        </div>

        @if (newPaymentMethod.type === 'card') {
          <div>
            <label class="block text-sm font-semibold text-slate-300 mb-2">Numéro de carte</label>
            <input
              type="text"
              [(ngModel)]="newPaymentMethod.cardNumber"
              name="cardNumber"
              placeholder="1234 5678 9012 3456"
              class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
            />
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-300 mb-2">Titulaire</label>
            <input
              type="text"
              [(ngModel)]="newPaymentMethod.cardHolder"
              name="cardHolder"
              placeholder="Nom sur la carte"
              class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
            />
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-300 mb-2">Date d'expiration</label>
            <input
              type="text"
              [(ngModel)]="newPaymentMethod.expiryDate"
              name="expiryDate"
              placeholder="MM/AA"
              class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
            />
          </div>
        } @else {
          <div>
            <label class="block text-sm font-semibold text-slate-300 mb-2">Nom de la banque</label>
            <input
              type="text"
              [(ngModel)]="newPaymentMethod.bankName"
              name="bankName"
              placeholder="Nom de la banque"
              class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
            />
          </div>
          <div>
            <label class="block text-sm font-semibold text-slate-300 mb-2">Numéro de compte</label>
            <input
              type="text"
              [(ngModel)]="newPaymentMethod.accountNumber"
              name="accountNumber"
              placeholder="Numéro de compte"
              class="w-full rounded-xl bg-slate-800 border border-slate-700 text-white px-4 py-2 focus:border-cyan-400 focus:outline-none"
            />
          </div>
        }

        <div class="flex items-center gap-2">
          <input
            type="checkbox"
            [(ngModel)]="newPaymentMethod.isDefault"
            name="isDefault"
            id="isDefault"
            class="w-4 h-4 rounded bg-slate-800 border-slate-700 text-cyan-500 focus:ring-cyan-500"
          />
          <label for="isDefault" class="text-sm text-slate-300">Définir comme moyen de paiement par défaut</label>
        </div>

        <div class="flex gap-3 pt-4">
          <button
            type="button"
            (click)="closeAddPaymentModal()"
            class="flex-1 px-4 py-2 rounded-xl border border-slate-600 text-slate-300 hover:border-slate-500 transition-colors"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="flex-1 px-4 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-semibold hover:shadow-lg transition-all"
          >
            Ajouter
          </button>
        </div>
      </form>
    </div>
  </div>
}
